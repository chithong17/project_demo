<UserControl x:Class="RestaurantWPF.Views.Customer.Components.MenuView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 🔹 Header -->
        <DockPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="🍽️ Menu"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#4E342E"
                       DockPanel.Dock="Left"
                       VerticalAlignment="Center"/>

            <StackPanel Orientation="Horizontal"
                        DockPanel.Dock="Right"
                        VerticalAlignment="Center">

                <TextBox Width="220"
                         Margin="0,0,10,0"
                         Padding="8"
                         VerticalAlignment="Center"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Tìm theo tên món..."/>

                <ComboBox Width="200"
                          ItemsSource="{Binding Categories}"
                          SelectedValue="{Binding SelectedCategoryId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          SelectedValuePath="CategoryId"
                          DisplayMemberPath="Name"
                          Margin="0,0,10,0"
                          ToolTip="Lọc theo danh mục"/>

                <Button Content="↻ Refresh"
                        Width="100"
                        Command="{Binding RefreshCommand}"/>
            </StackPanel>
        </DockPanel>

        <!-- 🔹 Danh sách món -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Foods}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel IsItemsHost="True" Margin="10"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="220" Height="320"
                                Margin="10"
                                CornerRadius="10"
                                Background="White"
                                BorderBrush="#DDD"
                                BorderThickness="1"
                                Effect="{DynamicResource DropShadowEffect}">
                            <StackPanel>
                                <Image Source="{Binding ImageUrl}"
                                       Height="150"
                                       Stretch="UniformToFill"
                                       Margin="0,0,0,10"
                                       ClipToBounds="True"/>

                                <TextBlock Text="{Binding Name}"
                                           FontWeight="Bold"
                                           FontSize="15"
                                           Foreground="#3E2723"
                                           TextWrapping="Wrap"
                                           Margin="10,0,10,4"/>

                                <TextBlock Text="{Binding Description}"
                                           FontSize="12"
                                           Foreground="#6D4C41"
                                           TextWrapping="Wrap"
                                           Margin="10,0,10,6"
                                           Opacity="0.8"/>

                                <DockPanel Margin="10,0,10,10"
                                           VerticalAlignment="Bottom">
                                    <TextBlock Text="{Binding Price, StringFormat='{}{0:N0} VND'}"
                                               FontWeight="Bold"
                                               Foreground="#E65100"
                                               FontSize="14"
                                               DockPanel.Dock="Left"
                                               VerticalAlignment="Center"/>

                                    <Button Content="🛒 Add"
                                            Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Background="#FF7043"
                                            Foreground="White"
                                            FontWeight="Bold"
                                            BorderThickness="0"
                                            Width="70"
                                            Height="28"
                                            HorizontalAlignment="Right"
                                            Cursor="Hand"
                                            DockPanel.Dock="Right"/>
                                </DockPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- 🟡 Floating Cart Icon (overlay) -->
        <Canvas>
            <Grid x:Name="CartIcon"
                  Width="60" Height="60"
                  Visibility="{Binding IsCartVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  Cursor="Hand"
                  MouseLeftButtonUp="CartIcon_Click"
                  Canvas.Right="30"
                  Canvas.Bottom="30">

                <Ellipse Fill="#FFA000" Width="60" Height="60" />
                <TextBlock Text="🛒"
                           FontSize="24"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>

                <Border Background="Red"
                        CornerRadius="10"
                        Width="22"
                        Height="22"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Margin="0,-5,-5,0">
                    <TextBlock Text="{Binding CartCount}"
                               Foreground="White"
                               FontSize="12"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </Canvas>
    </Grid>
</UserControl>
