<UserControl x:Class="RestaurantWPF.Views.Staff.Components.PaymentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:RestaurantWPF.Converters"
             mc:Ignorable="d">

    <UserControl.Resources>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:PaymentMethodConverter x:Key="PaymentMethodConverter"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2.8*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <TabControl Grid.ColumnSpan="2">
            <!-- 🧾 TAB 1: Đơn hàng chờ thanh toán -->
            <TabItem Header="💰 Đơn chờ thanh toán">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2.8*"/>
                        <ColumnDefinition Width="2*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="💰 Đơn hàng chờ thanh toán"
                                   FontSize="22"
                                   FontWeight="Bold"
                                   Foreground="#1B5E20"
                                   Margin="0,0,0,10"/>

                        <ListView ItemsSource="{Binding PendingOrders}"
                                  SelectedItem="{Binding SelectedOrder, Mode=TwoWay}"
                                  Margin="5"
                                  BorderThickness="0">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Mã đơn" Width="80" DisplayMemberBinding="{Binding OrderId}"/>
                                    <GridViewColumn Header="Khách hàng" Width="150" DisplayMemberBinding="{Binding Customer.FullName}"/>
                                    <GridViewColumn Header="Bàn" Width="80" DisplayMemberBinding="{Binding Table.Name}"/>
                                    <GridViewColumn Header="Giờ đặt" Width="150" DisplayMemberBinding="{Binding OrderTime, StringFormat={}{0:HH:mm dd/MM/yyyy}}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>

                    <!-- Panel chi tiết -->
                    <Border Grid.Column="1"
                            Margin="20,0,0,0"
                            Background="#FAFAFA"
                            Padding="20"
                            CornerRadius="10"
                            BorderBrush="#C8E6C9"
                            BorderThickness="1"
                            Visibility="{Binding IsOrderSelected, Converter={StaticResource BoolToVisibilityConverter}}">

                        <StackPanel>
                            <TextBlock Text="📋 Chi tiết thanh toán"
                                       FontSize="22"
                                       FontWeight="Bold"
                                       Foreground="#1B5E20"
                                       Margin="0,0,0,15"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Mã đơn: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedOrder.OrderId}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Khách hàng: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedOrder.Customer.FullName}"/>
                            </StackPanel>

                            <TextBlock Text="Danh sách món:" FontWeight="Bold" Margin="0,10,0,5"/>
                            <ItemsControl ItemsSource="{Binding SelectedOrder.OrderDetails}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                                            <TextBlock Text="{Binding Food.Name}" Width="200"/>
                                            <TextBlock Text="{Binding Quantity}" Width="40" HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding UnitPrice, StringFormat={}{0:N0} đ}" Width="100" HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Separator Margin="0,10,0,10"/>

                            <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                <TextBlock Text="Tổng tiền: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding PaidAmount, StringFormat={}{0:N0} đ}" Foreground="#2E7D32" FontWeight="Bold"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                <TextBlock Text="Phương thức: " FontWeight="Bold"/>
                                <ComboBox Width="150" SelectedIndex="{Binding SelectedMethod}">
                                    <ComboBoxItem Content="Tiền mặt"/>
                                    <ComboBoxItem Content="Thẻ"/>
                                    <ComboBoxItem Content="Ví điện tử"/>
                                </ComboBox>
                            </StackPanel>

                            <TextBlock Text="Ghi chú:" FontWeight="Bold" Margin="0,10,0,5"/>
                            <TextBox Text="{Binding Note}" Height="60" TextWrapping="Wrap"/>

                            <Button Content="Xác nhận thanh toán"
                                    Command="{Binding ConfirmPaymentCommand}"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    FontWeight="Bold"
                                    Height="40"
                                    Margin="0,15,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- 📜 TAB 2: Lịch sử thanh toán -->
            <TabItem Header="📜 Lịch sử thanh toán">
                <StackPanel>
                    <TextBlock Text="📜 Lịch sử thanh toán"
                               FontSize="22"
                               FontWeight="Bold"
                               Foreground="#1B5E20"
                               Margin="0,0,0,10"/>

                    <ListView ItemsSource="{Binding PaymentsHistory}"
                              Margin="5"
                              BorderThickness="0">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Mã thanh toán" Width="100" DisplayMemberBinding="{Binding PaymentId}"/>
                                <GridViewColumn Header="Đơn hàng" Width="100" DisplayMemberBinding="{Binding OrderId}"/>
                                <GridViewColumn Header="Số tiền" Width="120" DisplayMemberBinding="{Binding PaidAmount, StringFormat={}{0:N0} đ}"/>
                                <GridViewColumn Header="Phương thức" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Method, Converter={StaticResource PaymentMethodConverter}}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Thời gian" Width="180" DisplayMemberBinding="{Binding PaidAt, StringFormat={}{0:HH:mm dd/MM/yyyy}}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
